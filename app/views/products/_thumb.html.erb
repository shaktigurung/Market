<div>
  <div>
    <% unless product.product_images.empty? %>
      <%= link_to image_tag(product.product_images[0].image_url(:thumb)), product %>
    <% else%>
      <%= link_to image_tag(ActionController::Base.helpers.asset_path("default.jpg")), product %>
    <% end %>
  </div>
  <div>
    <%=product.name%>
  </div>
  <div>
    Quantity:
    <% if product.quantity > 0 %>
      <%= product.quantity %>
    <% else%>
      <span class="red">OUT OF STOCK</span>
    <% end %>
  </div>
  <% if user_signed_in? && current_user.id && current_user.id != product.user.id %> 
    <%= form_tag charges_path do %>
        <article>
            <% if flash[:error].present? %>
            <div id="error_explanation">
                <p><%= flash[:error] %></p>
            </div>
            <% end %>
            <label class="amount">
            <span> Price: $<%= (product.price).to_i %></span>
            </label>
            <input type="hidden" value="<%= product.id %>" name="product_id">
        </article>

        <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                                    data-key="<%= Rails.application.credentials.stripe[:PUBLISHABLE_KEY] %>"
                                    data-description=" What a buy !!! <%= current_user.first_name %>"
                                    data-label="Buy now"
                                    data-email="<%= current_user.email %>"
                                    data-amount="<%= ((product.price)*100) %>"
                                    data-locale="auto">
        </script>
    <% end %> 
  <% end %>
</div>
